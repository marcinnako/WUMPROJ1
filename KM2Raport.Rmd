---
title: 'WstÄ™p do Uczenia Maszynowego 2020: projekt I [kamieÅ„ milowy II]'
author: "Jakub Kosterna, Marcin Åukaszyk, MikoÅ‚aj Malec"
date: "26 marca 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\tableofcontents

## 1. OdÅ›wieÅ¼enie

Wpierw wczytajmy postÄ™py, ktÃ³re zrobiliÅ›my na pierwszym kamieniu milowym. OprÃ³cz wczytania ramki danych i jej eksploracji, obrobiliÅ›my jÄ… takÅ¼e w celu uzyskania bardziej przystÄ™pnej formy - miÄ™dzy innymi nadajÄ…c kolumnom "sensowne" nazwy.

Wczytajmy potrzebne pakiety i przypomnijmy sobie jak wyglÄ…daÅ‚a nasza ramka danych.

```{r pakiety, message = FALSE, warning = FALSE}
# install.packages("dplyr") # if not installed
library(dplyr)
```

```{r wczytajWyczysc, echo = FALSE}
#setwd("C:/Users/ckostern/Desktop/Studia/03 rok II semestr/ML/proj1/WUMPROJ1-master")
```

```{r, echo=FALSE}
data <- read.csv("german_credit_data_weka_dataset.csv")

levels(data[,1]) <- c("low", "fair", "high", "not_have") #DM low<0<fair<200<high
levels(data[,3]) <- c("all_paid", "all_paid_here", "paid_till_now", "delay", "critical")
levels(data[,4]) <- c("new_car", "used_car", "furniture/equipment", "radio/television", "domestic", "repairs", "education", "retraining", "business", "other") #note: 0 for vacation
levels(data[,6]) <- c("low","normal","high","very_high","not_have/unknown") #DM low<100<normal<500<high<1000<very_high
levels(data[,7]) <- c("unemployed", "less_than_year", "1-3_years", "4-6_yeras","7+_years")
levels(data[,9]) <- c("male_d/s", "female_d/s/m", "male_single", "male_m/w") #d = divorsed, s = seperated, m = married, w = widowed ,#note: 0 female single
levels(data[,10]) <- c("none", "co-applicant", "guarantor")
levels(data[,12]) <- c("real_estate", "building_savings", "car", "not_have/unknown")
levels(data[,14]) <- c("bank", "stores", "none")
levels(data[,15]) <- c("rent", "own", "for_free")
levels(data[,17]) <- c("unskilled_non_resident", "unskilled_resident", "skilled_employee", "highly_qualified_employee*") # also management, self-employed, officer
levels(data[,19]) <- c("no", "yes")
levels(data[,20]) <- c("yes", "no")
data[,21] <- as.factor(as.character(data[,21]))
levels(data[,21]) <- c("Good", "Bad")

num_data <- data[, c(2,5,8,11,13,16,18)]
```

```{r oglad}
knitr::kable(sample_n(data, 20))
```

## 2. Czyszczenie - braki, niepoprawne wartoÅ›ci i kluczowe kolumny

Takiego mamy farta, Å¼e do czego doszliÅ›my na pierwszym kamieniu milowym, nie mamy **Å¼adnych brakÃ³w danych**. Czy wszystkie wartoÅ›ci sÄ… jednak poprawne?

Jak wynika z histogramÃ³w naszego raportu wygenerowanego dziÄ™ki *DataExplorer*, **w przypadku danych kategorycznych wszystkie mamy w wersji poprawnej** - nie ma ani wartoÅ›ci dosÅ‚ownie jedno-lub parukrotnych sugerujÄ…cych bÅ‚Ä…d czy literÃ³wkÄ™.

**PatrzÄ…c na zmienne liczbowe, takÅ¼e wszystko jest na swoim miejscu** - wiek zawiera siÄ™ w przedziale <niecaÅ‚e 20; mniej niÅ¼ 100>, wartoÅ›ci kredytu to do 20 000 Euro, klient bierze co najwyÅ¼ej 4 rÃ³Å¼ne poÅ¼yczki i ogÃ³lnie mamy tu Å‚ad i skÅ‚ad.

PodsumowujÄ…c **nie ma ani outlierÃ³w wymagajÄ…cych usuniÄ™cia, ani wartoÅ›ci niezgodnych**.

Na chÅ‚opski rozum kaÅ¼dy atrybut moÅ¼e byÄ‡ istotny w kwestii oszacowania, czy ryzykujemy z daniem klientowi kredytu.

## 3. Encoding

Mamy 21 kolumn, z czego 14 zawiera kategoryczne zmienne tekstowe. PrzeksztaÅ‚Ä‡my naszÄ… ramkÄ™ danych tak, aby zawieraÅ‚a tylko wartoÅ›ci liczbowe!

## 3.1.1. Prosty problem zmiennych binarnych

Cechy *telephone*, *foreign_worker* i *customer_type* przyjmujÄ… tylko dwie wartoÅ›ci - te pierwsze dwie yes / no, ta ostatnia - Good / Bad. Sprawa prosta - dobre niech bÄ™dzie jedynkÄ…, a zÅ‚e - zerem.

```{r encoding1}
#to s?? faktory, wi??c as.numeric odczyta warto???? fatora, który jest numeric, a nie stringa
# 1 = true, 0 = false
num_data$has_telephone <- as.numeric(data$telephone) -1

num_data$is_foreign_worker <- as.numeric(data$foreign_worker)
num_data$is_foreign_worker[ num_data$is_foreign_worker == 2] <- 0

num_data$is_good_customer_type <- as.numeric(data$customer_type)
num_data$is_good_customer_type[ num_data$is_good_customer_type == 2] <- 0
```
## 3.1.2. *credit_history* - czy osoba sp??aca kredyt brany kredyt

Przetworzymy kolumny na to czy dana dana osoba ma problemy z p??aceniem kredytu, wiersze paid_till_now rozumiemy jako ??e nie by??o wczesniej problemu z p??aceniem kredytu

```{r}
num_data$has_problems_credit_history <- if_else( data$credit_history %in% c("delay", "critical"), 1, 0)
```


(Info: credit_history,string,"A30: no credits taken/ all credits paid back duly, A31: all credits at this bank paid back duly, A32: existing credits paid back duly till now, A33: delay in paying off in the past, A34 : critical account/ other credits existing (not at this bank)")

## 3.2. Kolumny nominalne

... czyli te, ktÃ³rych nie moÅ¼na jakoÅ› sensownie uporzÄ…dkowaÄ‡.

Dzieki wiedzy o tym na jaki cel kredytobiorca bierze kredyt mozna sie spodziewac w jakiej sytuacji finansowej jest ta osoba.


```{r}
#nie jest to optymalne rozdzielenie, istenieje funkcja 'one_hot' w pakiecie 'mltools', ale wspó??pracuje ona z pakietem 'data.table' przez co nale??a??oby przepisa?? ca???? nasz?? poprzedni?? prac??. Komentarz ma zaznaczy??, ??e istnieje sposób na automaczyczne podzielenie danych, ale z niego nie zko??ystali??my z powodów implementacyjnych
num_data$purpose_domestic <- if_else( data$purpose == "domestic", 1, 0)
num_data$purpose_retraining <- if_else( data$purpose == "retraining", 1, 0)
num_data$purpose_radio_television <- if_else( data$purpose == "radio/television", 1, 0)
num_data$purpose_new_car <- if_else( data$purpose == "new_car", 1, 0)
num_data$purpose_used_car <- if_else( data$purpose == "used_car", 1, 0)
num_data$purpose_business <- if_else( data$purpose == "business", 1, 0)
num_data$purpose_repairs <- if_else( data$purpose == "repairs", 1, 0)
num_data$purpose_education <- if_else( data$purpose == "education", 1, 0)
num_data$purpose_furniture_equipment <- if_else( data$purpose == "furniture/equipment", 1, 0)
num_data$purpose <- if_else( data$purpose == "new_car", 1, 0)
#other
```



*other_debtors*

Ta zmienna mowi o tym czy dany kredytobioraca ma jakies zagwarantowanie kredytu.

```{r}
num_data$other_debtors_guarantor <- if_else(data$other_debtors =="guarantor", 1, 0)
num_data$other_debtors_co_applicant <- if_else(data$other_debtors =="co-applicant", 1, 0)
#none
```

*other_installment_plans*

Analogicznie

```{r}
num_data$other_installment_plans_bank <- if_else( data$other_installment_plans =="bank", 1, 0)
num_data$other_installment_plans_stores <- if_else( data$other_installment_plans =="stores", 1, 0)
#none
```

*housing*

Analogicznie

```{r}
num_data$housing_rent <- if_else(data$housing == "rent", 1, 0)
num_data$housing_own <- if_else(data$housing == "own", 1, 0)
#for_free
```


### 3.3. Cechy uporzÄ…dkowane

*savings* jednoznacznie moÅ¼na uporzÄ…dkowaÄ‡

```{r}
#0=not_have/unknown 1=low 2=normal 3=high 4=very_high 
num_data$savings <- as.numeric( data$savings)
#not_have/unknown
num_data$savings[ num_data$savings == 5] <- 0
```


*present_employment* - niech dÅ‚uÅ¼szy staÅ¼ pracy wedÅ‚ug zaproponowanych podziaÅ‚ek bÄ™dzie wiÄ™kszÄ… liczbÄ… dla naturalnych > 0.

```{r}
num_data$present_employment <- if_else(data$present_employment %in% c("unemployed"), 0, if_else(data$present_employment %in% c("less_than_year"), 1,if_else(data$present_employment %in% c("1-3_years"), 2,if_else(data$present_employment %in% c("4-6_yeras"), 5,7))))
```


## 3.4. Zmienne "mieszane"

### 3.4.1. *checking_account_status*

W przypadku *checking_account_status* mamy wÅ‚aÅ›ciwie dwie informacje - czy *checking account* jest oraz jak jest - jaki jest jego status. Rozbijmy go na trzy kolumny, czy jest low, fair i high, je????i jest ??adnym z nich to klient go nie ma

```{r}
num_data$low_checking_account_status <- if_else( data$checking_account_status == 'low', 1, 0)
num_data$fair_checking_account_status <- if_else( data$checking_account_status == 'fair', 1, 0)
num_data$high_checking_account_status <- if_else( data$checking_account_status == 'high', 1, 0)
```

### 3.4.2. *personal* czyli pÅ‚eÄ‡ i stan cywilny na raz

W zaleÅ¼noÅ›ci od tego czy mamy stycznoÅ›Ä‡ z mÄ™Å¼czyznÄ… i ich stan cywilny. Podzielimy na 2 kolumny: binarne: p??e?? (is_women) (0 - mÄ™Å¼czyzna, 1 - kobieta) oraz czy jest singlem (nie by?? nigdy w zwi??zku)

```{r}
#0 - mÄ™Å¼czyzna, 1 - kobieta
num_data$is_women <- if_else( data$personal == "female_d/s/m", 1, 0)
#nie ma kobiet singli
num_data$is_single <- if_else( data$personal == "male_single", 1, 0)
```

### 3.4.3. *property*

Osoby s?? tutaj uporz??dkowane, je??li nie posiadaj?? real_estate, to mog?? posiada?? building_savings, je??li nie to car, ale to nie oznacza, ??e osoby z real_estate nie maj?? car. Dlatego traktujemy t?? kolumn?? jako uporz??dkowanie property, gdzie osoby z real_estate maj?? najwi??cej a not_have/unknown najmiej.

```{r}
num_data$property <- if_else( data$property == "real_estate", 3, if_else( data$property == "building_savings", 2, if_else( data$property == "car", 1, 0)))
```

### 3.4.4. *job*

Zrobimy podziaÅ‚ czy osoba posiada prac??

```{r}
num_data$job_skilled_employee <- if_else( data$job == "skilled_employee", 1,0)
num_data$job_unskilled_resident <- if_else( data$job == "unskilled_resident", 1,0)
num_data$job_highly_qualified_employee <- if_else( data$job == "highly_qualified_employee*", 1,0)
num_data$job_unskilled_non_resident <- if_else( data$job == "unskilled_non_resident", 1,0)
```

## 3.5

```{r oglad}
knitr::kable(sample_n(num_data, 20))
```

## 4. Klasyfikacja

JednoznacznÄ… zmiennÄ… celu naszej ramki danych jest oczywiÅ›cie *customer_type* - problem opÅ‚acalnoÅ›ci dania kredytu przez bank klientowi to wÅ‚aÅ›nie to, co chcemy przewidzieÄ‡. Podzielmy nasz dataset na X i y.

```{r podzialXy}
X <- data %>%
  select(-customer_type)
y <- data$customer_type
```

## 5. PodziaÅ‚ na zbiÃ³r treningowy i testowy
```{r}
set.seed(3113)
rows <- sample(nrow(num_data))
num_data <- num_data[rows, ]

test_data <- head(num_data,n = 200)
train_data <- tail(num_data,n = 800)
```


## 6. ZakoÅ„czenie

To by byÅ‚o na tyle.

Zobaczmy jeszcze efekt dziaÅ‚ania funkcji session_info:

```{r session_info}
sessionInfo()
```